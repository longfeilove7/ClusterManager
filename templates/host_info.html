<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Title</title>
    <link rel="stylesheet" href="/static/body.css">
    <link rel="stylesheet" href="/static/subrange.css">
    <style>
        td {text-align:center}/*table center*/
     </style>
     <script src="/static/jquery-3.3.1.min.js"></script>     
     <script src="/static/popper.js-1.14.3/dist/umd/popper.min.js"></script>
     {#<link rel="stylesheet" href="/static/bootstrap-4.1.1/css/bootstrap.min.css">#}
     <script src="/static/bootstrap-4.1.1/js/bootstrap.min.js"></script>
     <script src="/static/intercooler-1.2.1.min.js"></script>
     <script type="text/javascript">
        $(document).ready(function(){
            $("#mytable").find("tr").css("background-color", "#D1F7FA");
            $("#mytable").find("tr:odd").css("background-color", "#D1F0FA");
        });
        </script>
</head>
<body>
    <div class="pg-header">
        <div class="title left">
            超算管理中心
        </div>
        <div class="title right">
            当前用户: {{ obj.username }}
        </div>
    </div>
    <div class="pg-content">
        <div class="menu">
            <ul>
                <li>
                    <div>
                        <a href="/host_info/">主机管理</a>
                    </div>
                </li>
                <li style="width: 150px;height: 1px;background-color: white;margin-left: -25px"></li>
            </ul>
            <ul>
                <li>
                    <div>
                        <a href="/add_cluster/">集群管理</a>
                    </div>
                </li>
                <li style="width: 150px;height: 1px;background-color: white;margin-left: -25px"></li>
            </ul>
        </div>
        {#        右边主机内容#}
        <div class="content">
            <div class="add">
                <a>添加主机</a>
            </div>
            <div class="open">
                <a>批量开机</a>
            </div>
            <div class="close">
                <a>批量关机</a>
            </div>
            <div class="edit">
                <a>批量编辑</a>
            </div>
            <div class="delete">
                <a>批量删除</a>
            </div>
            <div class="bootdev">
                <form method="get">
                    <select name="app">
                        <option value="disk">DISK</option>
                        <option value="pxe">PXE</option>
                        <option value="cdrom">CDROM</option>
                        <option value="bios">BIOS</option>
                    </select>                                
                </form>                
            </div>
            <div style="position: absolute;top: 80px;left: 10px">
                <table id="mytable" border="1" cellspacing="0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>机房</th>
                            <th>机柜</th>
                            <th>刀箱</th>
                            <th>刀片</th>
                            <th>主机名</th>
                            <th>业务IP</th>
                            <th>管理IP</th>
                            <th>存储IP</th>
                            <th>集群</th>
                            <th>型号</th>
                            <th>操作系统</th>
                            <th>开机</th>
                            <th>关机</th>                           
                            <th>重启</th>
                            <th>开机时间</th>
                            <th>关机时间</th>
                            <th>状态</th>                            
                            <th>运行时长</th>
                            <th>bootdev</th>
                            <th>修改</th>
                            <th>删除</th>
                            <th><input type ="checkbox" onclick="chooseAll()" id="chooseAll" name="chooseAll" ></th>                            
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in obj %}
                        <tr>                            
                            <td>{{ row.id }}</td>
                            <td>{{ row.roomNO }}</td>
                            <td>{{ row.cabinetNO }}</td>
                            <td>{{ row.bladeBoxNO }}</td>
                            <td>{{ row.bladeNO}}</td>
                            <td>{{ row.hostName }}</td>
                            <td>{{ row.serviceIP }}</td>
                            <td>{{ row.manageIP }}</td>
                            <td>{{ row.storageIP }}</td>
                            <td>{{ row.hostCluster.hostCluster }}</td>
                            <td>{{ row.hardware }}</td>
                            <td>{{ row.service }}</td>
                            <td><input type="button" id="btn1" name="btn" value="On" onclick="toPowerOn('mytable',this)"></td>
                            <td><input type="button" id="btn2" name="btn" value="Off" onclick="toPowerOff('mytable',this)"></td>
                            <td><input type="button" id="btn3" name="btn" value="Cycle" onclick="toPowerCycle('mytable',this)"></td>
                            <td>{{ row.powerOnTime|date:"Y-m-d H:i:s" }}</td>
                            <td>{{ row.powerOffTime|date:"Y-m-d H:i:s" }}</td>
                            <td>{{ row.checkOnline }}</td>                            
                            <td>{{ row.runTime }}</td>
                            <td>
                                <form method="get">
                                <select name="app">
                                    <option value="disk">DISK</option>
                                    <option value="pxe">PXE</option>
                                    <option value="cdrom">CDROM</option>
                                    <option value="bios">BIOS</option>
                                </select>                                
                                </form>
                            </td>
                            <td><a id="edit" href="/host_edit-{{ row.id }}/" style="color: #00b3ca">修改</a></td>
{#                          <td><a id="del" href="/host_del-{{ row.id }}/" style="color: #00b3ca">删除</a></td>#}
                            <td><input type="button" id="{{ row.id }}" style="color: #00b3ca" value="删除" onclick="addElement()"></td>
                            <td><input type="checkbox"/></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>               
            </div>
        </div>
    </div>
    {#        模态对话框#}
    <div id="add-shadow" class="shadow hide"></div>
    <div id="add-model" class="model hide">
        <form action="/host_info/" method="post">
            {% csrf_token %}
            <ul>
                <li>
                    机房: <input type="text" name="roomNO">
                    机柜: <input type="text" name="cabinetNO">
                </li>
            </ul>
            <ul>
                <li>
                    刀箱: <input type="text" name="bladeBoxNO">
                    刀片: <input type="text" name="bladeNO">
                </li>
            </ul>
            <ul>
                <li>
                    主机名: <input type="text" name="hostName">
                    业务IP: <input type="text" name="serviceIP">
                </li>
            </ul>
            <ul>
                <li>
                    管理IP: <input type="text" name="manageIP">
                    业务IP: <input type="text" name="storageIP">
                </li>
            </ul>
            <ul>
                <li>
                    操作系统: <input type="text" name="service">
                    主机型号: <input type="text" name="hardware">
                </li>
            </ul>
            <ul>
                <li>集群:
                    <select  name="hostCluster">
                        {% for cluster in cluster_list %}
                        <option value="{{ cluster.id }}">{{ cluster.hostCluster }}</option>
                        {% endfor %}
                    </select>
                </li>
            </ul>
            <div>
                <ul>
                    <li>
                        <input type="submit" value="提交">
                        <input type="button" value="取消" onclick="cancelElement()">
                    </li>
                </ul>
            </div>
        </form>
    </div>
{#    删除的模态#}
    <div id="del-shadow" class="shadow hide"></div>
    <div id="del-model" class="model hide">
        <div style="position: absolute;top: 40%;left: 20%">
            <div>你确定要删除吗?</div>
            <form method="post">
                {% csrf_token %}
                <input type="submit" value="确定">
                <input type="button" value="取消" onclick="cancelAdd()">
            </form>
        </div>
    </div>
    
    <script>
{#        添加主机的模态对话框#}
         function cancelElement() {
            $('#add-shadow,#add-model').addClass('hide')
        }
        $('.add').click(function () {
            $('#add-shadow,#add-model').removeClass('hide')
        });
{#         删除的模态#}
        function addElement() {
{#            获取当前点击事件标签上的id#}
            document.body.onclick = function (event) {
                var id = event.target.id;
                console.log(id);
                if(id){
                    var link = "/host_del-" + id + '/';
                    console.log(link);
                    $('#del-model form').attr('action',link)
                }

            };

            $('#del-model,#del-shadow').removeClass('hide')
        }
        function cancelAdd() {
            $('#del-shadow,#del-model').addClass('hide')
        }        
    </script>

<script type="text/javascript">
 
 // using jQuery
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});

 /** 
  * 遍历表格内容返回数组
  * @param Int  id 表格id
  * @return Array
  */
 function toPowerOn(id,e){
    var getID = e.parentNode.parentNode.children[0].innerHTML;
    var getIP = e.parentNode.parentNode.children[7].innerHTML;
   
   if(confirm("Power on "+ getIP)){
   $.ajax({
       contentType: "application/x-www-form-urlencoded; charset=utf-8",
       //contentType: "application/json; charset=utf-8", //django not support json,don't use this
       dataType: "json", //for to get json
       url : "/power_on/",
       type : "POST",
       cache : false,
       data : {
            'ID':getID, 
            'IP':getIP
              },       
       beforeSend: function (xhr, settings) {
       //此处调用刚刚加入的js方法
        var csrftoken = getCookie('csrftoken'); 
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
       },
       success: function(data){                                                       
                            console.log(data)
                            //alert(data)
                            //以上是后端函数返回成功的信息
                            e.parentNode.parentNode.children[15].innerHTML=data[1]
                            if (data[2] == "fail"){
                                alert(data[0] + "poweron" + data[2])
                            }                            
                        },
        error: function(request,info,e){
                        alert("false");
                        console.log(e)
                        }
            })
        }
    }
 
</script>

<script type="text/javascript">
 
    // using jQuery
   function getCookie(name) {
       var cookieValue = null;
       if (document.cookie && document.cookie !== '') {
           var cookies = document.cookie.split(';');
           for (var i = 0; i < cookies.length; i++) {
               var cookie = jQuery.trim(cookies[i]);
               // Does this cookie string begin with the name we want?
               if (cookie.substring(0, name.length + 1) === (name + '=')) {
                   cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                   break;
               }
           }
       }
       return cookieValue;
   }
   var csrftoken = getCookie('csrftoken');
   
   function csrfSafeMethod(method) {
       // these HTTP methods do not require CSRF protection
       return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
   }
   $.ajaxSetup({
       beforeSend: function(xhr, settings) {
           if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
               xhr.setRequestHeader("X-CSRFToken", csrftoken);
           }
       }
   });
   
    /** 
     * 遍历表格内容返回数组
     * @param Int  id 表格id
     * @return Array
     */
    function toPowerOff(id,e){
       var getID = e.parentNode.parentNode.children[0].innerHTML;
       var getIP = e.parentNode.parentNode.children[7].innerHTML;
      
      if(confirm("Power off "+ getIP)){
      $.ajax({
          contentType: "application/x-www-form-urlencoded; charset=utf-8",
          //contentType: "application/json; charset=utf-8", //django not support json,don't use this
          dataType: "json", //for to get json
          url : "/power_off/",
          type : "POST",
          cache : false,
          data : {
               'ID':getID, 
               'IP':getIP
                 },       
          beforeSend: function (xhr, settings) {
          //此处调用刚刚加入的js方法
           var csrftoken = getCookie('csrftoken'); 
           if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           xhr.setRequestHeader("X-CSRFToken", csrftoken);
               }
          },
          success: function(data){ 
                                e.parentNode.parentNode.children[16].innerHTML=data[1]
                                e.parentNode.parentNode.children[18].innerHTML=data[3]
                                if (data[2] == "fail"){
                                alert(data[0] + "poweroff" + data[2])
                            }                                                                                       
                                console.log(data)
                                //alert(data[1])
                                //以上是后端函数返回成功的信息
                           },
           error: function(request,info,e){
                           alert("false");
                           console.log(e)
                           }
            })
        }
    }
    
   </script>

<script type="text/javascript">
 
    // using jQuery
   function getCookie(name) {
       var cookieValue = null;
       if (document.cookie && document.cookie !== '') {
           var cookies = document.cookie.split(';');
           for (var i = 0; i < cookies.length; i++) {
               var cookie = jQuery.trim(cookies[i]);
               // Does this cookie string begin with the name we want?
               if (cookie.substring(0, name.length + 1) === (name + '=')) {
                   cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                   break;
               }
           }
       }
       return cookieValue;
   }
   var csrftoken = getCookie('csrftoken');
   
   function csrfSafeMethod(method) {
       // these HTTP methods do not require CSRF protection
       return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
   }
   $.ajaxSetup({
       beforeSend: function(xhr, settings) {
           if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
               xhr.setRequestHeader("X-CSRFToken", csrftoken);
           }
       }
   });
   
    /** 
     * 遍历表格内容返回数组
     * @param Int  id 表格id
     * @return Array
     */
    function toPowerCycle(id,e){
       var getID = e.parentNode.parentNode.children[0].innerHTML;
       var getIP = e.parentNode.parentNode.children[7].innerHTML;
      
      if(confirm("Power cycle "+ getIP)){
      $.ajax({
          contentType: "application/x-www-form-urlencoded; charset=utf-8",
          //contentType: "application/json; charset=utf-8", //django not support json,don't use this
          dataType: "json", //for to get json
          url : "/power_cycle/",
          type : "POST",
          cache : false,
          data : {
               'ID':getID, 
               'IP':getIP
                 },       
          beforeSend: function (xhr, settings) {
          //此处调用刚刚加入的js方法
           var csrftoken = getCookie('csrftoken'); 
           if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           xhr.setRequestHeader("X-CSRFToken", csrftoken);
               }
          },
          success: function(data){ 
                                e.parentNode.parentNode.children[15].innerHTML=data[1]
                                if (data[2] == "fail"){
                                alert(data[0] + "poweron" + data[2])
                            }                                                                                       
                                console.log(data)
                                //alert(data[1])
                                //以上是后端函数返回成功的信息
                           },
           error: function(request,info,e){
                           alert("false");
                           console.log(e)
                           }
            })
        }
    }
    
   </script>

<script type="text/javascript">
 
    // using jQuery
   function getCookie(name) {
       var cookieValue = null;
       if (document.cookie && document.cookie !== '') {
           var cookies = document.cookie.split(';');
           for (var i = 0; i < cookies.length; i++) {
               var cookie = jQuery.trim(cookies[i]);
               // Does this cookie string begin with the name we want?
               if (cookie.substring(0, name.length + 1) === (name + '=')) {
                   cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                   break;
               }
           }
       }
       return cookieValue;
   }
   var csrftoken = getCookie('csrftoken');
   
   function csrfSafeMethod(method) {
       // these HTTP methods do not require CSRF protection
       return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
   }
   $.ajaxSetup({
       beforeSend: function(xhr, settings) {
           if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
               xhr.setRequestHeader("X-CSRFToken", csrftoken);
           }
       }
   });
   
    /** 
     * 遍历表格内容返回数组
     * @param Int  id 表格id
     * @return Array
     */
    function tobatchPowerOn(id,e){
       var getID = e.parentNode.parentNode.children[0].innerHTML;
       var getIP = e.parentNode.parentNode.children[7].innerHTML;
      
      if(confirm("Power cycle "+ getIP)){
      $.ajax({
          contentType: "application/x-www-form-urlencoded; charset=utf-8",
          //contentType: "application/json; charset=utf-8", //django not support json,don't use this
          dataType: "json", //for to get json
          url : "/power_cycle/",
          type : "POST",
          cache : false,
          data : {
               'ID':getID, 
               'IP':getIP
                 },       
          beforeSend: function (xhr, settings) {
          //此处调用刚刚加入的js方法
           var csrftoken = getCookie('csrftoken'); 
           if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
           xhr.setRequestHeader("X-CSRFToken", csrftoken);
               }
          },
          success: function(data){ 
                                e.parentNode.parentNode.children[15].innerHTML=data[1]
                                if (data[2] == "fail"){
                                alert(data[0] + "poweron" + data[2])
                            }                                                                                       
                                console.log(data)
                                //alert(data[1])
                                //以上是后端函数返回成功的信息
                           },
           error: function(request,info,e){
                           alert("false");
                           console.log(e)
                           }
            })
        }
    }
    
   </script>

<script>
//     $(function(){
//         //$('table tr:not(:first)').remove();
//         var len = $('table tr').length;
//         for(var i = 1;i<len;i++){
//             $('table tr:eq('+i+') td:first').text(i);
//         }
            
// });
    $(function(){
        
        $("table tr").click(function(){
            var input = $(this).find("input[type=checkbox]");//获取checkbox    
             
            //判断当前checkbox是否为选中状态
            if(input.is(":checked")){           
                input.attr("checked",false);
            }else{
                input.attr("checked",true);
            }
             
        })  
    })
    </script>
</body>
</html>